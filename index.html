<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ú©Ø§ØªØ§Ù„ÙˆÚ¯ Ù¾Ø®Ø´ Ù¾Ø§Ø±Ø§Ø¯Ø§ÛŒØ³</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#5b2aa6" />

<style>
:root {
  --brand:#5b2aa6;
  --brand-soft:#7a3ef2;
  --bg:#f6f7fb;
  --card:#fff;
  --text:#222;
  --muted:#666;
  --ok:#12a150;
  --bad:#d54b4b;
  --radius:18px;
}

/* ---- Ø³Ø§Ø®ØªØ§Ø± Ø§ØµÙ„ÛŒ ---- */
*{box-sizing:border-box}
body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:15px/1.6 Vazirmatn,IRANSans,system-ui;
}
header {
  background:var(--brand);
  color:#fff;
  padding:22px 16px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:5;
}
h1{margin:0;font-weight:800}

.search-wrap{
  display:flex;
  justify-content:center;
  margin:16px 0;
}
.search {
  width:min(720px,92%);
  padding:10px 14px;
  border-radius:999px;
  border:0;
  outline:0;
  background:#fff;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
}

.grid {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:12px;
  padding:12px;
  width:min(1400px,98%);
  margin:0 auto;
}
@media(max-width:1000px){.grid{grid-template-columns:repeat(4,1fr)}}
@media(max-width:800px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:560px){.grid{grid-template-columns:repeat(3,1fr)}}

.card {
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:0 4px 10px rgba(0,0,0,.06);
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition:transform .2s ease;
}
.card:hover{transform:translateY(-3px)}
.card img {
  width:100%;
  aspect-ratio:3/4;
  object-fit:cover;
  object-position:center;
  background:#eee;
}
.card-body{padding:8px}
.title{font-weight:700;font-size:.9rem;line-height:1.3;margin-bottom:4px}
.meta{font-size:.75rem;color:var(--muted);margin-bottom:4px}

.row{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.stock-dot{width:10px;height:10px;border-radius:50%;display:inline-block}
.stock-dot.ok{background:#12a150}
.stock-dot.bad{background:#d54b4b}
.stock-text{font-weight:700;color:#222;font-size:.8rem}

/* ---- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø¯ ---- */
.cart-controls{
  display:flex;
  align-items:center;
  gap:6px;
  margin-top:6px;
  flex-wrap:wrap;
  font-size:0.85rem;
}
.btn-qty{
  background:var(--brand-soft);
  color:#fff;
  border:none;
  width:28px; height:28px;
  font-size:15px;
  border-radius:8px;
  cursor:pointer;
  transition:.2s filter;
}
.btn-qty:hover{filter:brightness(.92)}
.qty-input{
  width:56px;
  text-align:center;
  border:1px solid #ccc;
  border-radius:8px;
  padding:3px;
  font-family:inherit;
  font-size:0.8rem;
  background:#fff;
}
.hint{
  font-size:.75rem;
  color:#999;
  flex-basis:100%;
}
.btn-add{
  flex:1;
  background:linear-gradient(90deg,#5b2aa6,#7a3ef2);
  color:#fff;
  border:none;
  padding:6px 8px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.btn-add:hover{filter:brightness(1.1)}

.empty,.loading{text-align:center;color:var(--muted);padding:28px}

/* ---- Ø¯Ú©Ù…Ù‡ Ø´Ù†Ø§ÙˆØ± Ø³Ø¨Ø¯ ---- */
#cart-btn {
  position:fixed;
  bottom:20px;
  left:20px;
  background:var(--brand);
  color:#fff;
  border:none;
  border-radius:999px;
  padding:14px 20px;
  font-weight:700;
  font-size:1rem;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
  cursor:pointer;
  z-index:100;
}

/* ---- Ù¾Ù†Ù„ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ---- */
#cart-panel {
  position:fixed; inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}
#cart-panel.active {display:flex;}
.cart-box {
  background:#fff;
  border-radius:20px;
  padding:24px;
  width:min(500px,90%);
  max-height:80vh;
  overflow:auto;
  box-shadow:0 8px 30px rgba(0,0,0,.25);
  animation:pop .3s ease;
}
@keyframes pop {from{transform:scale(.9);opacity:0} to{transform:scale(1);opacity:1}}
.cart-item {padding:6px 0;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
.cart-actions {display:flex;justify-content:space-between;align-items:center;margin-top:16px;}
.btn-close {background:#ccc;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;}
.btn-wa {
  background:#25D366; color:#fff; border:none; padding:8px 14px;
  border-radius:8px; font-weight:600; cursor:pointer;
}
.btn-remove{
  background:#ffdddd;border:none;color:#d33;border-radius:6px;padding:3px 6px;cursor:pointer;font-size:.75rem;
}
</style>
</head>

<body>
<header><h1>Ú©Ø§ØªØ§Ù„ÙˆÚ¯ Ù¾Ø®Ø´ Ù¾Ø§Ø±Ø§Ø¯Ø§ÛŒØ³</h1></header>

<main>
  <div class="search-wrap"><input id="q" class="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ: Ù†Ø§Ù…ØŒ Ú©Ø¯ØŒ ÛŒØ§ Ø¯Ø³ØªÙ‡â€¦"></div>
  <div class="grid" id="grid"></div>
  <div class="loading" id="loading">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒâ€¦</div>
  <div class="empty" id="empty" style="display:none">Ù…ÙˆØ±Ø¯ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.</div>
</main>

<button id="cart-btn">ğŸ›’ Ø³Ø¨Ø¯ (<span id="cart-count">0</span>)</button>

<div id="cart-panel">
  <div class="cart-box">
    <h2>Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±</h2>
    <div id="cart-list"></div>
    <div class="cart-actions">
      <button class="btn-close">Ø¨Ø³ØªÙ†</button>
      <button class="btn-wa" id="wa-send" style="display:none;">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ÙˆØ§ØªØ³Ø§Ù¾</button>
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://script.google.com/macros/s/AKfycbwuCceT_kp1PLKxEXz5wvcKXyx9RJHjPdgIHHIHtGOSBQ1cQRq4YViYOIHuRckkn1qOvQ/exec';
const TELE_PROXY = 
const PAGE_SIZE = 48;
let allItems = [];
const cart = {};

const elGrid = document.getElementById('grid');
const elCartBtn = document.getElementById('cart-btn');
const elCartCount = document.getElementById('cart-count');
const elCartPanel = document.getElementById('cart-panel');
const elCartList = document.getElementById('cart-list');
const elWASend = document.getElementById('wa-send');
const elQ = document.getElementById('q');

function cardHTML(it){
  const PLACEHOLDER =
    'data:image/svg+xml;utf8,' + encodeURIComponent(
      `<svg xmlns="http://www.w3.org/2000/svg" width="600" height="800">
         <rect width="100%" height="100%" fill="#eee"/>
         <text x="50%" y="50%" fill="#999" font-size="28" text-anchor="middle" dominant-baseline="middle">Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±</text>
       </svg>`);

  const isUrl = /^https?:\/\//i.test((it.photo_endpoint||'').trim());
  const hasProxy = TELE_PROXY && it.photo;
  const imgSrc = isUrl ? it.photo_endpoint
                       : (hasProxy ? `${TELE_PROXY}?fid=${encodeURIComponent(it.photo)}`
                                   : PLACEHOLDER);

  // ... Ø¨Ù‚ÛŒÙ‡â€ŒÛŒ HTML Ú©Ø§Ø±Øª (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
}

/* -------- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ -------- */
async function fetchPage(page){
  const url = new URL(API_BASE, location.origin);
  url.searchParams.set('fn','products');
  url.searchParams.set('page',page);
  url.searchParams.set('pagesize',PAGE_SIZE);
  const res = await fetch(url);
  return res.json();
}

async function loadAll(){
  const data = await fetchPage(0);
  allItems = data.items || [];
  elGrid.innerHTML = allItems.map(cardHTML).join('');
}

/* -------- Ø¬Ø³ØªØ¬Ùˆ -------- */
elQ.addEventListener('input', ()=>{
  const q = elQ.value.trim();
  const list = q ? allItems.filter(it =>
    (it.name||'').toLowerCase().includes(q.toLowerCase()) ||
    (it.code||'').includes(q)
  ) : allItems;
  elGrid.innerHTML = list.map(cardHTML).join('');
});

/* -------- Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø¨Ø¯ -------- */
function updateCartCount(){
  const total = Object.values(cart).reduce((a,b)=>a+(b.qty||0),0);
  elCartCount.textContent = total;
  elWASend.style.display = total>0 ? 'inline-block' : 'none';
}
function renderCart(){
  if(Object.keys(cart).length===0){
    elCartList.innerHTML='<p>Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</p>';
    elWASend.style.display='none';
    return;
  }
  elWASend.style.display='inline-block';
  elCartList.innerHTML = Object.entries(cart).map(([code,it])=>`
    <div class="cart-item">
      <span>${it.name} â€” (${code}) Ã— ${it.qty}</span>
      <div>
        <button class="btn-remove" data-code="${code}">Ø­Ø°Ù</button>
      </div>
    </div>`).join('');
}
function openCart(){
  renderCart();
  elCartPanel.classList.add('active');
}

/* -------- ÙˆØ§ØªØ³Ø§Ù¾ -------- */
function makeWAurl(){
  let txt = `ğŸ’œ *Ù¾Ø®Ø´ Ù¾Ø§Ø±Ø§Ø¯Ø§ÛŒØ³ | Paradise Distribution*\nğŸ§¾ *Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø³ÙØ§Ø±Ø´*\n\n`;
  Object.entries(cart).forEach(([c,info],i)=>{
    txt += `${i+1}. ${info.name} (Ú©Ø¯ ${c}) â€” ${info.qty} Ø¹Ø¯Ø¯\n`;
  });
  txt += `\nØ§Ø±Ø³Ø§Ù„ Ø§Ø² Ú©Ø§ØªØ§Ù„ÙˆÚ¯ Ø±Ø³Ù…ÛŒ Ù¾Ø§Ø±Ø§Ø¯Ø§ÛŒØ³`;
  return `https://wa.me/989027898758?text=${encodeURIComponent(txt)}`;
}

/* -------- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ -------- */
document.body.addEventListener('click', e=>{
  if(e.target.matches('.btn-add')){
    const code = e.target.dataset.code;
    const name = e.target.dataset.name;
    const qtyInput = document.querySelector(`.qty-input[data-code="${code}"]`);
    const qty = parseInt(qtyInput.value,10) || 1;
    cart[code] = {name, qty};
    updateCartCount();
  }
  if(e.target.matches('.btn-remove')){
    const code = e.target.dataset.code;
    delete cart[code];
    updateCartCount();
    renderCart();
  }
  if(e.target.matches('.btn-qty')){
    const code = e.target.dataset.code;
    const input = document.querySelector(`.qty-input[data-code="${code}"]`);
    let val = parseInt(input.value,10)||1;
    val = e.target.dataset.op==='plus'? val+1 : Math.max(1,val-1);
    input.value=val;
    if(cart[code]) cart[code].qty=val;
    updateCartCount();
  }
  if(e.target.matches('#cart-btn')) openCart();
  if(e.target.matches('.btn-close')) elCartPanel.classList.remove('active');
  if(e.target.matches('.btn-wa')) window.open(makeWAurl(),'_blank');
});

/* -------- Ø´Ø±ÙˆØ¹ -------- */
loadAll();
</script>
</body>
</html>
